<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/8e7dc2ee26.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/cithara/assets/css/main.css">
    <link rel="stylesheet" href="/cithara/assets/css/header.css">
    <title>Cithara - A Guitar Web Application</title>
</head>

<body>
    <nav>
        <div class="nav-top-bar">
            <ul class="start">
                <li class="button" onclick="previous()">
                    <span><i class="fa-solid fa-arrow-left"></i></span>
                </li>
                <li class="text">
                    <span>Strum</span>
                </li>
            </ul>
            <ul class="center justify">
            </ul>
            <ul class="end">
                <li class="button" onclick="fullscreen()">
                    <span><i class="fa-solid fa-expand"></i></span>
                </li>
                <li class="button" onclick="">
                    <span><i class="fa-solid fa-question"></i></span>
                </li>
            </ul>
        </div>
    </nav>
    <main>
        <link rel="stylesheet" href="/cithara/assets/css/playstyle.css">
        <section id="strum-container">
            <svg viewBox="0 0 1520 720">
                <path
                    d="M100 320 q 0 300 100 500 q 0 0 1500 0 q 0 0 0 -500 M100 320 q 0 -300 100 -500 q 0 0 1500 0 q 0 0 0 500"
                    fill="rgb(229, 194, 156)"></path>
                <circle cx="760" cy="320" r="300" fill="white"></circle>
                <circle cx="760" cy="320" r="200" fill="rgb(74, 63, 50)"></circle>
                <rect x="0" y="170" rx="4" ry="4" width="560" height="300" fill="rgb(160, 122, 81)"></rect>
                <rect x="50" y="1750" rx="4" ry="4" width="10" height="300" fill="rgb(74, 63, 50)"></rect>
                <rect x="150" y="170" rx="4" ry="4" width="10" height="300" fill="rgb(74, 63, 50)"></rect>
                <rect x="250" y="170" rx="4" ry="4" width="10" height="300" fill="rgb(74, 63, 50)"></rect>
                <rect x="350" y="170" rx="4" ry="4" width="10" height="300" fill="rgb(74, 63, 50)"></rect>
                <rect x="450" y="170" rx="4" ry="4" width="10" height="300" fill="rgb(74, 63, 50)"></rect>
                <rect x="550" y="170" rx="4" ry="4" width="10" height="300" fill="rgb(74, 63, 50)"></rect>
                <rect x="1237.5" y="87.5" rx="8" ry="8" width="100" height="475" fill="rgb(160, 122, 81)"></rect>
                <rect x="1262.5" y="105" rx="8" ry="8" width="50" height="425" fill="white"></rect>
                <circle cx="1287.5" cy="197.5" r="10" fill="rgb(54, 45, 37)"></circle>
                <circle cx="1287.5" cy="247.5" r="10" fill="rgb(54, 45, 37)"></circle>
                <circle cx="1287.5" cy="297.5" r="10" fill="rgb(54, 45, 37)"></circle>
                <circle cx="1287.5" cy="347.5" r="10" fill="rgb(54, 45, 37)"></circle>
                <circle cx="1287.5" cy="397.5" r="10" fill="rgb(54, 45, 37)"></circle>
                <circle cx="1287.5" cy="447.5" r="10" fill="rgb(54, 45, 37)"></circle>

                <rect class="string" x="0" y="445" rx="5" width="1287.5" height="4" fill="rgb(54, 45, 37)"></rect>
                <rect class="string" x="0" y="395" rx="5" width="1287.5" height="5" fill="rgb(54, 45, 37)"></rect>
                <rect class="string" x="0" y="345" rx="5" width="1287.5" height="6" fill="rgb(54, 45, 37)"></rect>
                <rect class="string" x="0" y="295" rx="5" width="1287.5" height="7" fill="rgb(54, 45, 37)"></rect>
                <rect class="string" x="0" y="245" rx="5" width="1287.5" height="8" fill="rgb(54, 45, 37)"></rect>
                <rect class="string" x="0" y="195" rx="5" width="1287.5" height="10" fill="rgb(54, 45, 37)"></rect>
                <g></g>
            </svg>
            <div id="strumSetting">
                <div id="strumBPM">
                    <div>
                        <span id="strumBPMValue" style="width: 4rem;">BPM</span>
                    </div>
                    <div>
                        <span>
                            <input type="range" id="strumRange" min="30" max="150" value="90">
                        </span>
                    </div>
                </div>
                <div id="strumPatternSelect">
                    <span>
                        <select id="select">
                            <option value="-1" default="">Select Strum</option>
                        </select>
                    </span>
                </div>
                <div style="justify-content: center;">
                    <div id="strumMute">
                        <input id="muteCheckbox" type="checkbox">
                        <span id="muteDisplay" style="color: var(--green)">
                            <svg class="svg-inline--fa fa-volume-high fa-xl" aria-hidden="true" focusable="false"
                                data-prefix="fas" data-icon="volume-high" role="img" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 640 512" data-fa-i2svg="">
                                <path fill="currentColor"
                                    d="M533.6 32.5C598.5 85.3 640 165.8 640 256s-41.5 170.8-106.4 223.5c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C557.5 398.2 592 331.2 592 256s-34.5-142.2-88.7-186.3c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5zM473.1 107c43.2 35.2 70.9 88.9 70.9 149s-27.7 113.8-70.9 149c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C475.3 341.3 496 301.1 496 256s-20.7-85.3-53.2-111.8c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5zm-60.5 74.5C434.1 199.1 448 225.9 448 256s-13.9 56.9-35.4 74.5c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C393.1 284.4 400 271 400 256s-6.9-28.4-17.7-37.3c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5zM301.1 34.8C312.6 40 320 51.4 320 64V448c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h67.8L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3z">
                                </path>
                            </svg><!-- <i class="fa-solid fa-volume-high fa-xl"></i> Font Awesome fontawesome.com -->
                        </span>
                    </div>
                    <div id="strumPlay">
                        <input id="playCheckbox" type="checkbox">
                        <span id="playDisplay" style="color: var(--blue)">
                            <svg class="svg-inline--fa fa-play fa-xl" aria-hidden="true" focusable="false"
                                data-prefix="fas" data-icon="play" role="img" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 384 512" data-fa-i2svg="">
                                <path fill="currentColor"
                                    d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z">
                                </path>
                            </svg><!-- <i class="fa-solid fa-play fa-xl"></i> Font Awesome fontawesome.com -->
                        </span>
                    </div>
                </div>
            </div>
            <audio src="/cithara/assets/audio/up.m4a" id="up"></audio>
            <audio src="/cithara/assets/audio/down.m4a" id="down"></audio>
        </section>
    </main>
    <script src="/cithara/assets/javascript/main.js"></script>
    <script>
        const strums = [
            {
                "songName": "\u2193 \u21C0 \u2193 \u21C0 \u2193 \u21C0 \u2193",
                "songPattern": [-1, 0, -1, 0, -1, 0, -1, 0]
            },
            {
                "songName": "\u2191 \u21C0 \u2191 \u21C0 \u2191 \u21C0 \u2191",
                "songPattern": [1, 0, 1, 0, 1, 0, 1, 0]
            },
            {
                "songName": "\u2193 \u21C0 \u2191 \u21C0 \u2193 \u21C0 \u2191",
                "songPattern": [-1, 0, 1, 0, -1, 0, 1, 0]
            },
            {
                "songName": "\u2193 \u2191 \u2193 \u2191 \u2193 \u2191 \u2193 \u2191",
                "songPattern": [-1, 1, -1, 1, -1, 1, -1, 1]
            },
            {
                "songName": "\u2193 \u21C0 \u2193 \u2191 \u21C0 \u2191 \u2193 \u21C0",
                "songPattern": [-1, 0, -1, 1, 0, 1, -1, 0]
            },
            {
                "songName": "\u2193 \u2191 \u2193 \u2191 \u21C0 \u2191 \u2193 \u21C0",
                "songPattern": [-1, 1, -1, 1, 0, 1, -1, 0]
            },
            {
                "songName": "\u2193 \u2193 \u2193 \u2193 \u2193 \u2193 \u2193 \u2193",
                "songPattern": [-1, -1, -1, -1, -1, -1, -1, -1]
            },
            {
                "songName": "\u2193 \u2191 \u2193 \u2191 \u21C0 \u2191 \u21C0 \u2191",
                "songPattern": [-1, 1, -1, 1, 0, 1, 0, 1]
            }
        ]
    </script>
    <script>

        const slider = document.querySelector("#strumRange");
        const sliderValue = document.querySelector('#strumBPMValue');
        let timeoutId;
        let bpm = slider.value;
        let bpmInterval = (60 / bpm) * 1000;

        let sliderRect = slider.getBoundingClientRect();
        let sliderValueRect = sliderValue.getBoundingClientRect();

        slider.addEventListener('input', () => {
            const value = slider.value;
            sliderValue.textContent = value;

            // Clear the previous timeout (if it exists)
            clearTimeout(timeoutId);

            // Set a new timeout to hide the sliderValue after 3 seconds
            timeoutId = setTimeout(function () {
                sliderValue.textContent = "BPM";
            }, 3000);

            bpm = slider.value;
            bpmInterval = (60 / bpm) * 1000;
        });

        const beatValue = [0, 0, 0, 0, 0, 0, 0, 0];

        const select = document.querySelector("#select");

        strums.forEach((item, index) => {
            let option = document.createElement("option");
            option.text = item.songName;
            option.value = index;
            select.appendChild(option);
        });

        select.addEventListener("change", function () {
            strums.forEach((item, index) => {

                beatValue[index] = strums[parseInt(select.value)].songPattern[index]

                if (strums[parseInt(select.value)].songPattern[index] === 1) {
                    item.innerHTML = "<i class='fa-solid fa-up-long fa-2xl'></i>";
                } else if (strums[parseInt(select.value)].songPattern[index] === -1) {
                    item.innerHTML = "<i class='fa-solid fa-down-long fa-2xl'></i>";
                } else {
                    item.innerHTML = "<i class='fa-solid fa-minus fa-2xl'></i>";
                }
            })
        });

        const muteCheckbox = document.querySelector("#muteCheckbox");
        const playCheckbox = document.querySelector("#playCheckbox");

        let mute = false;

        muteCheckbox.addEventListener("change", function () {

            muteDisplay = document.querySelector("#muteDisplay");

            if (mute) {
                mute = false;

                muteDisplay.style.color = "var(--green)";
                muteDisplay.innerHTML = "<i class='fa-solid fa-volume-high fa-xl'></i>";
            } else {
                mute = true;

                muteDisplay.style.color = "var(--red)";
                muteDisplay.innerHTML = "<i class='fa-solid fa-volume-xmark fa-xl'></i>";
            }

        });

        let playDisplay = document.querySelector("#playDisplay");

        let intervalId;

        playCheckbox.addEventListener("change", function () {
            play = playCheckbox.checked;
            changePlayButton();

            if (play) {
                // Start playing
                startPlayback();
            } else {
                // Stop playback
                stopPlayback();
            }
        });

        function startPlayback() {
            let index = 0;
            switch (beatValue[index]) {
                case 1:
                    up.currentTime = 0;
                    if (!mute) { up.play(); }
                    break;
                case -1:
                    down.currentTime = 0;
                    if (!mute) { down.play(); }
                    break;
                default:
                    break;
            }
            highlightBeat(beatValue[index]);

            index++;

            intervalId = setInterval(function () {
                if (index >= beatValue.length) {
                    setTimeout(stopPlayback(), 1000);
                }

                const value = beatValue[index];
                switch (value) {
                    case 1:
                        up.currentTime = 0;
                    if (!mute) { up.play(); }
                        break;
                    case -1:
                        down.currentTime = 0;
                        if (!mute) { down.play(); }
                        break;
                    default:
                        break;
                }
                highlightBeat(beatValue[index]);

                index++;
            }, bpmInterval);
        }

        function stopPlayback() {
            clearInterval(intervalId); // Stop the playback interval
            playCheckbox.checked = false; // Uncheck the checkbox
            changePlayButton();
        }

        function highlightBeat(value) {
            if (value === 1) {
                document.querySelectorAll(".string").forEach((string, index) => {
                    setTimeout(() => { 
                        string.style.fill = "var(--blue)";
                    }, 100 * index);
                    setTimeout(() => { 
                        string.style.fill = "rgb(54, 45, 37)";
                    }, 150 * (index + 1));
                })
            } else if (value === -1) {
                let reverseNodes = [];
                for(let i = document.querySelectorAll(".string").length; i > 0; i--) {
                    reverseNodes.push(document.querySelectorAll(".string")[i - 1]);
                }

                reverseNodes.forEach((string, index) => {
                    setTimeout(() => { 
                        string.style.fill = "var(--red)";
                    }, 100 * index);
                    setTimeout(() => { 
                        string.style.fill = "rgb(54, 45, 37)";
                    }, 150 * (index + 1));
                })
            }
            
        }

        function changePlayButton() {
            highlightBeat(0);
            if (playCheckbox.checked) {
                playDisplay.style.color = "var(--orange)";
                playDisplay.innerHTML = "<i class='fa-solid fa-pause fa-xl'></i>";
            } else {
                playDisplay.style.color = "var(--blue)";
                playDisplay.innerHTML = "<i class='fa-solid fa-play fa-xl'></i>";
            }
        }

    </script>
</body>

</html>